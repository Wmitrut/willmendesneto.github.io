<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Why track loop is important in your angular apps</title>
  <meta name="description" content="This is my blog, where i talk about technologies" />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="canonical" href="http://willmendesneto.github.io/2016/08/15/why-track-loop-is-important-in-your-angular-apps">

  
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="cache-control" content="no-store, no-cache, must-revalidate" />
    <meta http-equiv="Pragma" content="no-store, no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta http-equiv="CACHE-CONTROL" content="NO-CACHE" />
    <meta http-equiv="PRAGMA" content="NO-CACHE" />
    <meta name="domain" content="willmendesneto.github.io" />
    <meta name="url" content="/2016/08/15/why-track-loop-is-important-in-your-angular-apps" />

    <meta property="og:type" content="article" />
    <meta property="og:title" content="Why track loop is important in your angular apps" />
    <meta property="og:url" content="/2016/08/15/why-track-loop-is-important-in-your-angular-apps" />
    <meta property="og:description" content="" />
    <meta property="article:author" content="" />
    <meta property="og:site_name" content="Wilson Mendes - Blog" />
    <meta property="og:image" content="" />
    <meta name="twitter:site" content="@willmendesneto" />
    <meta name="twitter:image" content="" />
    <meta name="twitter:card" content="summary" />
    <meta name="autor" content="Wilson Mendes" />
    <meta name="reply-to" content="willmendesneto@gmail.com">
    <meta name="revisit-after" content="3" />
    <meta name="title" content="Wilson Mendes - Blog">
    <meta name="description" content="This is my blog, where i talk about technologies">
    <meta name="keywords" content="["frontend",, "javascript",, "performance",, "angularjs"]" />
  

  <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Pesquisa no Blog" />

  <link rel="shortcut icon" href="/assets/images/favicon.ico">
<!--  <link rel="stylesheet" href=""> -->
  <!-- <link rel="stylesheet" href="http://brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i"> -->
  <link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,400italic,600,700,800" rel="stylesheet" type="text/css">

  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" media="screen" href="/assets/css/main.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="/assets/css/solarized-dark.css" />
  <link rel="stylesheet" type="text/css" media="print" href="/assets/css/print.css" />
</head>

  <body itemscope itemtype="http://schema.org/Article" id="body-content">
    <!-- header start -->

<!-- <a href="http://willmendesneto.github.io" class="logo-readium"><span class="logo" style="background-image: url()"></span></a> -->

<!-- header end -->

    <main class="content" role="main">
      <article class="post">
        
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">Why track loop is important in your angular apps</h1>
            <div class="cf post-meta-text">
              <div class="author-image" style="background-image: url(https://pt.gravatar.com/userimage/20307137/677413a79461cdfd62c8a65143214850.png?size=300)">Blog Logo</div>
              <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person">Will Mendes</h4>
              on
              <time datetime="2016-08-15T00:00:00+00:00">15 Aug 2016</time>
              <!-- , tagged on <span class="post-tag-">, <a href="/tag/"></a></span> -->
            </div>
          </div>
        </div>
        <br>
        <br>
        <br>
        
        <section class="post-content">

          <a class="home-button"  href="/">&laquo; Home</a>
          <div class="post-reading">
            Lido a <span class="post-reading-time"></span>
          </div>
          <a name="topofpage"></a>
          <div id="post-content-page">
            <h2 id="introduction">Introduction</h2>

<p>Hello everyone. This post will be something good and easy to read, but totally essential if you care about performance in you Angular App. The idea of this post is talk about why your loop should gave <code class="highlighter-rouge">track by</code> with some index information.</p>

<blockquote>
  <p>But we already know about it because angular documentation already talk about that</p>
</blockquote>

<p>I’m working as a consultant in biggest and medium angular projects and the problems around the teams forget about that approach creates a lot of problems. So what I’m writing here is basically an overview about the angular behaviours and why you need to take care about it.</p>

<p>So…let’s go!</p>

<h2 id="about-angular-apps-and-loops">About Angular apps and loops</h2>

<p>Since angular borns the idea was (and still is): make the WebApps development easier. And the framework provide us lots of tools to make our life simple as possible and delivery business value fast.</p>

<p>Yeah! <em>delivery business value</em>! If your code doesn’t delivery business value, so we have something wrong…but I will talk more about that in the next posts.</p>

<p>We have the concept of directives: a new way to handle with WebApps creating decoupled components with specific rules based in your application domain. All built in core directives use <code class="highlighter-rouge">ng*</code> pattern and that’s the case of our <code class="highlighter-rouge">ngRepeat</code>.</p>

<p>If we take a look in ngRepeat documentation we can realise the main goal around this directive: render information iterating over a collection. Reading a little more we can realise that we have other patterns:</p>

<ul>
  <li>You shouldn’t use <code class="highlighter-rouge">$</code> or <code class="highlighter-rouge">$$</code> prefixes in your collection informations: Angular use this character for handle with public (<code class="highlighter-rouge">$</code>) and private (<code class="highlighter-rouge">$$</code>) properties. We have some public properties, such as <code class="highlighter-rouge">$index</code>, <code class="highlighter-rouge">$first</code>, <code class="highlighter-rouge">$last</code> and others;</li>
</ul>

<p>The interest thing is around angular creates some private properties. One of them is created when <code class="highlighter-rouge">track by</code> rule is not added in your iteration/loop.</p>

<h2 id="why-we-need-to-pass-a-index-with-a-unique-value">Why we need to pass a index with a unique value</h2>

<p>The rule around <code class="highlighter-rouge">track by</code> is pretty simple. It’s used to avoid duplication in your repeater.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'plunker'</span><span class="p">,</span> <span class="p">[]);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">'MainCtrl'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">items</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="na">_id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="s1">'Josh'</span><span class="p">},</span>
    <span class="p">{</span><span class="na">_id</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="s1">'Joseph'</span><span class="p">},</span>
    <span class="p">{</span><span class="na">_id</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="s1">'Kevin'</span><span class="p">}</span>
  <span class="p">];</span>
<span class="p">});</span>
</code></pre>
</div>

<div class="language-html highlighter-rouge"><pre class="highlight"><code>...
<span class="nt">&lt;div</span> <span class="na">ng-repeat=</span><span class="s">"item in items"</span><span class="nt">&gt;</span>
  
<span class="nt">&lt;/div&gt;</span>
...
</code></pre>
</div>

<p>So in this code example we are not tracking our collection and the angular creates a unique key to avoid <a href="https://docs.angularjs.org/error/ngRepeat/dupes">Duplicate Key in Repeater error</a> in our code. This generated unique key is <code class="highlighter-rouge">$$hashKey</code>.</p>

<p><img src="/assets/images/ng-repeat-error-duplicate-key.png" alt="Duplicate Key in Repeater error" /></p>

<p>Simple and fast, but now we have a problem. If you change your collection information for any reason (a polling, for example) the way of the data is updated is totally different. If you are not using <code class="highlighter-rouge">track by</code>, your angular App creates the <code class="highlighter-rouge">$$hashKey</code> property for you and when you update the information you are <strong>removing and creating a new element instead update the data</strong>.</p>

<blockquote>
  <p>But wait! This is a big performance issue in the framework!</p>
</blockquote>

<p>No, it’s not. This is the common “Read the documentation” error. You can <a href="https://docs.angularjs.org/api/ng/directive/ngRepeat">find all the details in ngRepeat documentation</a>.</p>

<p><img src="/assets/images/hashkey-ng-repeat.png" alt="Angular documentation: who ngRepeat approach with $$hashKey works" /></p>

<p>So, the correct implementation is use the same code in your javascript and update your html to track your unique key.</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">ng-repeat=</span><span class="s">"item in items track by item._id"</span><span class="nt">&gt;</span>
  
<span class="nt">&lt;/div&gt;</span>
</code></pre>
</div>

<p>PS: If you like to see this code running, please access the <a href="https://embed.plnkr.co/vIZP3U">plunker with this example using Angular1</a>.</p>

<h2 id="track-by-in-angular2-apps">Track by in Angular2 apps</h2>

<p>In Angular2 apps you should use <code class="highlighter-rouge">trackBy</code> too. In the new syntax <code class="highlighter-rouge">ngRepeat</code> was replaced to <code class="highlighter-rouge">ngFor</code>, but the approach still simple.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="s1">'demo-app'</span><span class="p">,</span>
  <span class="na">templateUrl</span><span class="p">:</span> <span class="s1">'app/app.component.html'</span><span class="p">,</span>
  <span class="na">pipes</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">})</span>

<span class="kr">export</span> <span class="kr">class</span> <span class="nx">AppComponent</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="nx">trackByItemId</span><span class="p">(</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">item</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"TrackBy"</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">item</span><span class="p">,</span> <span class="s2">"data using"</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="s2">"unique key."</span><span class="p">);</span>
    <span class="k">return</span><span class="p">(</span> <span class="nx">item</span><span class="p">.</span><span class="nx">id</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="p">...</span>
<span class="p">}</span>
</code></pre>
</div>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="err">*</span><span class="na">ngFor=</span><span class="s">"let item of items; trackBy:trackByItemId"</span><span class="nt">&gt;</span>
  
<span class="nt">&lt;/div&gt;</span>
</code></pre>
</div>

<p>PS: If you like to see this code running, please access the <a href="http://embed.plnkr.co/oi0OIzoJA9o6ppiMEjQM">plunker with this example using Angular2</a>.</p>

<h2 id="conclusion">Conclusion</h2>

<p>As you can see the benefits around start an application with simple best practices is really powerful. In some specific cases this change can decrease substantially the resource consumption.</p>

<p>Thank you and see you soon!</p>

<p>Links:</p>

<ul>
  <li>Angular <code class="highlighter-rouge">ngRepeat</code> documentation: <a href="https://docs.angularjs.org/api/ng/directive/ngRepeat">https://docs.angularjs.org/api/ng/directive/ngRepeat</a></li>
  <li><code class="highlighter-rouge">Duplicate Key in Repeater</code> error: <a href="https://docs.angularjs.org/error/ngRepeat/dupes">https://docs.angularjs.org/error/ngRepeat/dupes</a></li>
  <li>Angular2 - If you are using Angular2, use <code class="highlighter-rouge">ngForTrackBy</code> in ngFor…PLEASE!: <a href="http://embed.plnkr.co/oi0OIzoJA9o6ppiMEjQM">http://embed.plnkr.co/oi0OIzoJA9o6ppiMEjQM/</a></li>
  <li>Angular1 - Use <code class="highlighter-rouge">track by</code> in ngRepeat…PLEASE!: <a href="https://embed.plnkr.co/vIZP3U">https://embed.plnkr.co/vIZP3U/</a></li>
</ul>


          </div>
        </section>

        
          <section class="newsletter-content">
    <form action="http://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open('http://feedburner.google.com/fb/a/mailverify?uri=willmendesneto', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true;" >
        <h3 class="newsletter-title">Receive news by email</h3>
        <p class="newsletter-text">Subscribe to my newsletter to receive notifications of new articles in your e- mail</p>
        <input class="input-newsletter" type="email" name="email" placeholder="email"/>
        <input type="hidden" value="willmendesneto" name="uri"/>
        <input type="hidden" name="loc" value="en_US"/>
        <input class="btn btn-newsletter" type="submit" value="Subscribe" />
    </form>
</section>

        

        <footer class="post-footer">

          <div class="addthis_toolbox addthis_default_style addthis_32x32_style">
  <a class="addthis_button_preferred_1"></a>
  <a class="addthis_button_preferred_2"></a>
  <a class="addthis_button_preferred_3"></a>
  <a class="addthis_button_preferred_4"></a>
  <a class="addthis_button_preferred_5"></a>
</div>


          <!-- <section class="share">
            
              
                <a class="icon-twitter" href="http://twitter.com/share?text=Why+track+loop+is+important+in+your+angular+apps&amp;url=http://willmendesneto.github.io/2016/08/15/why-track-loop-is-important-in-your-angular-apps"
                  onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
                <i class="fa fa-twitter"></i><span class="hidden">twitter</span>
                </a>
              
            
              
                <a class="icon-facebook" href="//www.facebook.com/sharer.php?t=Why+track+loop+is+important+in+your+angular+apps&amp;u=http://willmendesneto.github.io/2016/08/15/why-track-loop-is-important-in-your-angular-apps"
                  onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;">
                <i class="fa fa-facebook"></i><span class="hidden">facebook</span>
                </a>
              
            
              
            
              
                <a class="icon-google-plus" href="https://plus.google.com/share?t=Why+track+loop+is+important+in+your+angular+apps&amp;url=http://willmendesneto.github.io/2016/08/15/why-track-loop-is-important-in-your-angular-apps"
                  onclick="window.open(this.href, 'google-plus-share', 'width=550,height=255');return false;">
                <i class="fa fa-google-plus"></i><span class="hidden">google-plus</span>
                </a>
              
            
          </section> -->
        </footer>
        <div class="bottom-teaser cf">
          <div class="isLeft">
            <section class="author">
              <div class="author-image" style="background-image: url(https://pt.gravatar.com/userimage/20307137/677413a79461cdfd62c8a65143214850.png?size=300)">Blog Logo</div>
              <h4>Wilson Mendes</h4>
              
                <p class="bio">Google Developer Expert (GDE) AngularJS and GDG Salvador Organizer. Musician and designer in his spare time.</p>
              
              <hr>
              <p class="published">Publicado em <time datetime="2016-08-15 00:00">15 Aug 2016</time></p>
            </section>
            <footer class="site-footer">
              <section class="poweredby">Mais um blog feito com <a href="http://jekyllrb.com">Jekyll</a></section>
              <a class="subscribe" href="/feed.xml" target="_blank"> <span class="tooltip"> <i class="fa fa-rss"></i> Assine o feed.</span></a>
            </footer>
          </div>
          
        </div>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'willmendesnetogithubio'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */

        'use strict';

        function load() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

          // Remove o evento
          window.onscroll = function() {};
        }

        window.onscroll = function() {
          if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 2000)) {
            load();
          }
        };
        </script>

        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </article>

    </main>
    <div class="bottom-closer">
      <div class="background-closer-image"  style="background-image: url(/assets/images/background-1.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">Wilson Mendes - Blog</h1>
        <h2 class="blog-description">This is my blog, where i talk about technologies</h2>
        <a href="/" class="btn">Back to Home</a>
      </div>
    </div>

    
<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-53c591e4471ce379" async="async"></script>

<script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="https://hammerjs.github.io/dist/hammer.js"></script>
<script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/assets/js/index.js"></script>
<script type="text/javascript" src="/assets/js/readingTime.min.js"></script>
<script>

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-58169656-1', 'auto');
ga('send', 'pageview');

(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    $window.on('scroll', function() {
      var top = $window.scrollTop();

      if (top < 0 || top > 1500) { return; }
      $image
        .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
        .css('opacity', 1-Math.max(top/700, 0));
    });
    $window.trigger('scroll');

    var height = $('.article-image').height();
    $('.post-content').css('padding-top', height + 'px');

    $('a[href*=#]:not([href=#])').click(function() {
      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
       && location.hostname == this.hostname) {
        var target = $(this.hash);
        target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
        if (target.length) {
          $('html,body').animate({ scrollTop: target.offset().top }, 500);
          return false;
        }
      }
    });
  });
}(jQuery));
</script>

  </body>
</html>
