<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Trabalhando com Thin Directives no AngularJS</title>
  <meta name="description" content="This is my blog, where i talk about technologies" />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="canonical" href="http://willmendesneto.github.io/2014/07/26/trabalhando-com-thin-directives-no-angularjs">

  
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="cache-control" content="no-store, no-cache, must-revalidate" />
    <meta http-equiv="Pragma" content="no-store, no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta http-equiv="CACHE-CONTROL" content="NO-CACHE" />
    <meta http-equiv="PRAGMA" content="NO-CACHE" />
    <meta name="domain" content="willmendesneto.github.io" />
    <meta name="url" content="/2014/07/26/trabalhando-com-thin-directives-no-angularjs" />

    <meta property="og:type" content="article" />
    <meta property="og:title" content="Trabalhando com Thin Directives no AngularJS" />
    <meta property="og:url" content="/2014/07/26/trabalhando-com-thin-directives-no-angularjs" />
    <meta property="og:description" content="" />
    <meta property="article:author" content="" />
    <meta property="og:site_name" content="Wilson Mendes - Blog" />
    <meta property="og:image" content="https://pbs.twimg.com/profile_images/2149314222/square.png" />
    <meta name="twitter:site" content="@willmendesneto" />
    <meta name="twitter:image" content="https://pbs.twimg.com/profile_images/2149314222/square.png" />
    <meta name="twitter:card" content="summary" />
    <meta name="autor" content="Wilson Mendes" />
    <meta name="reply-to" content="willmendesneto@gmail.com">
    <meta name="revisit-after" content="3" />
    <meta name="title" content="Wilson Mendes - Blog">
    <meta name="description" content="This is my blog, where i talk about technologies">
    <meta name="keywords" content="["angularjs",, "javascript",, "directives",, "architecture"]" />
  

  <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Pesquisa no Blog" />

  <link rel="shortcut icon" href="/assets/images/favicon.ico">
<!--  <link rel="stylesheet" href=""> -->
  <!-- <link rel="stylesheet" href="http://brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i"> -->
  <link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,400italic,600,700,800" rel="stylesheet" type="text/css">

  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" media="screen" href="/assets/css/main.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="/assets/css/solarized-dark.css" />
  <link rel="stylesheet" type="text/css" media="print" href="/assets/css/print.css" />
</head>

  <body itemscope itemtype="http://schema.org/Article" id="body-content">
    <!-- header start -->

<!-- <a href="http://willmendesneto.github.io" class="logo-readium"><span class="logo" style="background-image: url()"></span></a> -->

<!-- header end -->

    <main class="content" role="main">
      <article class="post">
        
        <div class="article-image">
          <div class="post-image-image" style="background-image: url(https://pbs.twimg.com/profile_images/2149314222/square.png)">
            Article Image
          </div>
          <div class="post-meta">
            <h1 class="post-title">Trabalhando com Thin Directives no AngularJS</h1>
            <div class="cf post-meta-text">
              <div class="author-image" style="background-image: url(https://pt.gravatar.com/userimage/20307137/677413a79461cdfd62c8a65143214850.png?size=300)">Blog Logo</div>
              <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person">Wilson Mendes</h4>
              on
              <time datetime="2014-07-26 00:00">26 Jul 2014</time>
              <!-- , tagged on <span class="post-tag-">, <a href="/tag/"></a></span> -->
            </div>
            <div style="text-align:center">
              <a href="#topofpage" class="topofpage"><i class="fa fa-angle-down"></i></a>
            </div>
          </div>
        </div>
        
        <section class="post-content">

          <a class="home-button"  href="/">&laquo; Home</a>
          <div class="post-reading">
            Lido a <span class="post-reading-time"></span>
          </div>
          <a name="topofpage"></a>
          <div id="post-content-page">
            <p><a class="page-link" href="/2014/09/22/working-with-thin-directives-in-angularjs">Veja a versão em inglês</a></p>

<h2 id="introduo">INTRODUÇÃO</h2>

<p>O conceito de diretivas no AngularJS é algo bastante interessante para apps, visando aspectos como reuso, portabilidade, modularização, dentre outros. Porém, a depender da complexidade de sua diretiva, alguns testes tornam-se mais complexos. Uma abordagem para simplificar alguns procedimentos é a contrução de diretivas baseando-se no conceito de diretivas “magras” (Thin Directives). Conheci este conceito no post de Joel Hooks <a href="http://joelhooks.com/blog/2014/02/11/lets-make-full-ass-angularjs-directives/">“Let’s Make Full-Ass AngularJS Directives”</a>, onde ele aborda os conceito de uma maneira bastante simples. Recomendo esta leitura, bastante explicativo!</p>

<p>O conceito de thin directives é a construção de uma diretiva Angular utilizando também outros componentes (como Controllers, Services, Factories, etc) como base de uma diretiva. Com esta abordagem os testes ficam muito mais simples, já que você delega algumas responsabilidades a outros componentes Angular.</p>

<h2 id="problema-diretiva-navbar">PROBLEMA: DIRETIVA NAVBAR</h2>

<p>Criaremos uma diretiva de menu como exemplo. Algo bastante simples, mas acredito que bem didático para que todos entendam melhor este novo conceito (para alguns) e algumas formas de utilizá-lo. A idéia é que nossa diretiva possa verificar qual item está sendo acessado em tempo real, a partir das informações passadas pela url.</p>

<p>Para isto vamos criar 3 arquivos para lidar diretamente com esta diretiva:</p>

<ul>
  <li><code class="highlighter-rouge">navbar.html</code>: Template da nossa diretiva com as informações e valores a serem atualizados.</li>
  <li><code class="highlighter-rouge">navbar-ctrl.js</code>: Controller para o nosso menu. Ele será responsável por fazer a integração para que o nosso controller funcione perfeitamente</li>
  <li><code class="highlighter-rouge">navbar.js</code>: Diretiva de nosso app. Este arquivo será bem compacto, pois possuirá somente algumas configurações mais simples.</li>
</ul>

<p>Baseando a construção de nossa diretiva em <a href="http://pt.wikipedia.org/wiki/Test_Driven_Development">TDD</a>, vamos focar no conceito de <a href="http://www.jamesshore.com/Blog/Red-Green-Refactor.html">Red, Green, Refactor</a>, assim além do conceito de Thin Directives, ainda teremos conhecimento de TDD (para quem tem dúvidas sobre).</p>

<h2 id="criao-da-diretiva">CRIAÇÃO DA DIRETIVA</h2>

<p>Inicialmente temos este código html que se tornará o template de nossa aplicação, o arquivo com a configuração das rotas de nosso app e outro template html que será o da diretiva.</p>

<p><code class="highlighter-rouge">index.html</code>:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!doctype html&gt;</span>
<span class="c">&lt;!--[if lt IE 7]&gt;      &lt;html class="no-js lt-ie9 lt-ie8 lt-ie7"&gt; &lt;![endif]--&gt;</span>
<span class="c">&lt;!--[if IE 7]&gt;         &lt;html class="no-js lt-ie9 lt-ie8"&gt; &lt;![endif]--&gt;</span>
<span class="c">&lt;!--[if IE 8]&gt;         &lt;html class="no-js lt-ie9"&gt; &lt;![endif]--&gt;</span>
<span class="c">&lt;!--[if gt IE 8]&gt;&lt;!--&gt;</span> <span class="nt">&lt;html</span> <span class="na">class=</span><span class="s">"no-js"</span><span class="nt">&gt;</span> <span class="c">&lt;!--&lt;![endif]--&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"IE=edge"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;&lt;/title&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">content=</span><span class="s">""</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script&gt;</span><span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'&lt;base href="'</span> <span class="o">+</span> <span class="nb">document</span><span class="p">.</span><span class="nx">location</span> <span class="o">+</span> <span class="s1">'" /&gt;'</span><span class="p">);</span><span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body</span> <span class="na">ng-app=</span><span class="s">"plunkerApp"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- Esta é a nossa diretiva--&gt;</span>
    <span class="nt">&lt;navbar&gt;&lt;/navbar&gt;</span>
    <span class="c">&lt;!-- --&gt;</span>

    <span class="c">&lt;!-- Add your site or application content here --&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span> <span class="na">ng-view=</span><span class="s">""</span><span class="nt">&gt;&lt;/div&gt;</span>

    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://ajax.googleapis.com/ajax/libs/angularjs/1.2.6/angular.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"angular-route.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"app.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"navbar-ctrl.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"navbar.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<p><code class="highlighter-rouge">app.js</code>:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'plunkerApp'</span><span class="p">,</span> <span class="p">[</span>
  <span class="s1">'ngRoute'</span>
<span class="p">])</span>
  <span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$routeProvider</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$routeProvider</span>
      <span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">templateUrl</span><span class="p">:</span> <span class="s1">'list.html'</span><span class="p">,</span>
        <span class="na">controller</span><span class="p">:</span> <span class="s1">'ContactsCtrl'</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="s1">'/contacts'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">templateUrl</span><span class="p">:</span> <span class="s1">'list.html'</span><span class="p">,</span>
        <span class="na">controller</span><span class="p">:</span> <span class="s1">'ContactsCtrl'</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">otherwise</span><span class="p">({</span>
        <span class="na">redirectTo</span><span class="p">:</span> <span class="s1">'/'</span>
      <span class="p">});</span>
  <span class="p">});</span></code></pre></figure>

<p><code class="highlighter-rouge">navbar.html</code>:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"header"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav nav-pills pull-right"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;li</span> <span class="na">ng-class=</span><span class="s">"{active:isActive('/')}"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Home<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li</span> <span class="na">ng-class=</span><span class="s">"{active:isActive('#/contacts')}"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#/contacts"</span><span class="nt">&gt;</span>Contacts<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"text-muted"</span><span class="nt">&gt;</span>THIN DIRECTIVE EXAMPLE<span class="nt">&lt;/h3&gt;</span>
<span class="nt">&lt;/div&gt;</span></code></pre></figure>

<p><code class="highlighter-rouge">isActive()</code> é o método que o controller <code class="highlighter-rouge">NavbarCtrl</code> utilizará acessando a diretiva, mas por ora não criaremos o controller e sim a nossa diretiva. Porém temos que fazer alguns testes para validarmos a diretiva e saber se tudo está ocorrendo corretamente. Vamos ao nosso teste:</p>

<p><code class="highlighter-rouge">navbar-test.js</code>:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">'Directive: navbar'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

  <span class="c1">// load the directive's module</span>
  <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">module</span><span class="p">(</span><span class="s1">'plunkerApp'</span><span class="p">));</span>

  <span class="kd">var</span> <span class="nx">element</span><span class="p">,</span>
    <span class="nx">template</span><span class="p">,</span>
    <span class="nx">httpBackend</span><span class="p">,</span>
    <span class="nx">scope</span><span class="p">;</span>

  <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">inject</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$rootScope</span><span class="p">,</span> <span class="nx">$compile</span><span class="p">,</span> <span class="nx">_$httpBackend_</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">scope</span> <span class="o">=</span> <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">$new</span><span class="p">();</span>
    <span class="nx">httpBackend</span> <span class="o">=</span> <span class="nx">_$httpBackend_</span><span class="p">;</span>

    <span class="nx">template</span> <span class="o">=</span> <span class="s1">'&lt;div class="header"&gt;'</span> <span class="o">+</span>
  <span class="s1">'&lt;ul class="nav nav-pills pull-right"&gt;'</span> <span class="o">+</span>
  <span class="s1">'  &lt;li ng-class="{active:{active:isActive('</span><span class="o">/</span><span class="s1">')}"&gt;&lt;a href="#"&gt;Home&lt;/a&gt;&lt;/li&gt;'</span> <span class="o">+</span>
  <span class="s1">'  &lt;li ng-class="{active:isActive('</span><span class="err">#</span><span class="o">/</span><span class="nx">contacts</span><span class="s1">')}"&gt;&lt;a href="#/contacts"&gt;Contacts&lt;/a&gt;&lt;/li&gt;'</span> <span class="o">+</span>
  <span class="s1">'&lt;/ul&gt;'</span> <span class="o">+</span>
  <span class="s1">'&lt;h3 class="text-muted"&gt;THIN DIRECTIVE EXAMPLE&lt;/h3&gt;'</span> <span class="o">+</span>
<span class="s1">'&lt;/div&gt;'</span><span class="p">;</span>
    <span class="nx">httpBackend</span><span class="p">.</span><span class="nx">whenGET</span><span class="p">(</span><span class="s1">'navbar.html'</span><span class="p">).</span><span class="nx">respond</span><span class="p">(</span><span class="nx">template</span><span class="p">);</span>

    <span class="nx">element</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">element</span><span class="p">(</span><span class="nx">template</span><span class="p">);</span>
    <span class="nx">element</span> <span class="o">=</span> <span class="nx">$compile</span><span class="p">(</span><span class="nx">element</span><span class="p">)(</span><span class="nx">scope</span><span class="p">);</span>
  <span class="p">}));</span>

  <span class="nx">it</span><span class="p">(</span><span class="s1">'should create a navbar header with ".header" class in element'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">'header'</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="s1">'should create a navbar header with ng-controller value equals "NavbarCtrl"'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'ng-controller'</span><span class="p">)).</span><span class="nx">toEqual</span><span class="p">(</span><span class="s1">'NavbarCtrl'</span><span class="p">);</span>
  <span class="p">});</span>

<span class="p">});</span></code></pre></figure>

<p>Agora vamos criar a nossa diretiva</p>

<p><code class="highlighter-rouge">navbar.js</code>:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'plunkerApp'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">directive</span><span class="p">(</span><span class="s1">'navbar'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">restrict</span><span class="p">:</span> <span class="s1">'E'</span><span class="p">,</span>
      <span class="na">templateUrl</span><span class="p">:</span> <span class="s1">'navbar.html'</span><span class="p">,</span>
      <span class="na">controller</span><span class="p">:</span> <span class="s1">'NavbarCtrl'</span><span class="p">,</span>
    <span class="p">};</span>
  <span class="p">});</span></code></pre></figure>

<p>Estamos utilizando a diretiva com o formato “elemento”. Temos alguns formatos para diretivas:</p>

<ul>
  <li>‘E’: Elemento (<navbar></navbar>);</li>
  <li>‘C’: Classe (&lt;div class="navbar"&gt;&lt;/div&gt;);</li>
  <li>‘A’: Atributo (&lt;div navbar &gt;&lt;/div&gt;);</li>
</ul>

<p>Estas opções podem ser combinadas, o que abre um leque de possibilidades a mais para as diretivas.
Ex :</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'plunkerApp'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">directive</span><span class="p">(</span><span class="s1">'navbar'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">restrict</span><span class="p">:</span> <span class="s1">'EAC'</span><span class="p">,</span> <span class="c1">// Aceita o formato de classe, atributo ou element</span>
      <span class="na">templateUrl</span><span class="p">:</span> <span class="s1">'navbar.html'</span><span class="p">,</span>
      <span class="na">controller</span><span class="p">:</span> <span class="s1">'NavbarCtrl'</span><span class="p">,</span>
    <span class="p">};</span>
  <span class="p">});</span></code></pre></figure>

<p>Caso queiram saber mais sobre as diretivas, dêem uma olhada na <a href="https://docs.angularjs.org/guide/directive">documentação das diretivas do angularjs</a>.</p>

<h2 id="etapa-final-da-construo-da-diretiva">ETAPA FINAL DA CONSTRUÇÃO DA DIRETIVA</h2>

<p>Ainda assim, nosso teste não estará correto, pois não temos o nosso controller criado. Vamos criar agora ele e o seu respectivo teste</p>

<p><code class="highlighter-rouge">navbar-ctrl-test.js</code>:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">'Controller: NavbarCtrl'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

  <span class="c1">// load the controller's module</span>
  <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">module</span><span class="p">(</span><span class="s1">'plunkerApp'</span><span class="p">));</span>

  <span class="kd">var</span> <span class="nx">NavbarCtrl</span><span class="p">,</span>
    <span class="nx">scope</span><span class="p">,</span>
    <span class="nx">location</span><span class="p">;</span>

  <span class="c1">// Initialize the controller and a mock scope</span>
  <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">inject</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$controller</span><span class="p">,</span> <span class="nx">$rootScope</span><span class="p">,</span> <span class="nx">$location</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">location</span> <span class="o">=</span> <span class="nx">$location</span><span class="p">;</span>
    <span class="nx">scope</span> <span class="o">=</span> <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">$new</span><span class="p">();</span>
    <span class="nx">NavbarCtrl</span> <span class="o">=</span> <span class="nx">$controller</span><span class="p">(</span><span class="s1">'NavbarCtrl'</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">$scope</span><span class="p">:</span> <span class="nx">scope</span>
    <span class="p">});</span>
  <span class="p">}));</span>

  <span class="nx">describe</span><span class="p">(</span><span class="s1">'isActive'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>

    <span class="nx">it</span><span class="p">(</span><span class="s1">'should return "true" when paths are the same'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">location</span><span class="p">.</span><span class="nx">path</span><span class="p">(</span><span class="s1">'/'</span><span class="p">);</span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">scope</span><span class="p">.</span><span class="nx">isActive</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)).</span><span class="nx">toBeTruthy</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="s1">'should return "false" when paths aren\'t the same'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">location</span><span class="p">.</span><span class="nx">path</span><span class="p">(</span><span class="s1">'/'</span><span class="p">);</span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">scope</span><span class="p">.</span><span class="nx">isActive</span><span class="p">(</span><span class="s1">'/error'</span><span class="p">)).</span><span class="nx">toBeFalsy</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="s1">'should return "true" when word starts are the same'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">location</span><span class="p">.</span><span class="nx">path</span><span class="p">(</span><span class="s1">'/contacts/1/edit'</span><span class="p">);</span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">scope</span><span class="p">.</span><span class="nx">isActive</span><span class="p">(</span><span class="s1">'/contacts'</span><span class="p">)).</span><span class="nx">toBeTruthy</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="s1">'should return "true" when word starts are the same followed by query string'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">location</span><span class="p">.</span><span class="nx">path</span><span class="p">(</span><span class="s1">'/contacts?id=1'</span><span class="p">);</span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">scope</span><span class="p">.</span><span class="nx">isActive</span><span class="p">(</span><span class="s1">'/contacts'</span><span class="p">)).</span><span class="nx">toBeTruthy</span><span class="p">();</span>
    <span class="p">});</span>

  <span class="p">});</span>
<span class="p">});</span></code></pre></figure>

<p><code class="highlighter-rouge">navbar-ctrl.js</code>:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'plunkerApp'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">'NavbarCtrl'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">$location</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$scope</span><span class="p">.</span><span class="nx">isActive</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">currentPath</span> <span class="o">=</span> <span class="nx">$location</span><span class="p">.</span><span class="nx">path</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">currentPath</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">'?'</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">currentPath</span> <span class="o">=</span> <span class="nx">currentPath</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'?'</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">currentPath</span> <span class="o">===</span> <span class="nx">path</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
    <span class="p">};</span>
  <span class="p">});</span></code></pre></figure>

<p>Agora ao rodar os testes, tudo estará ok.</p>

<h2 id="concluso">CONCLUSÃO</h2>

<p>Diretivas magras são interessantes para diretivas com complexidade média e/ou alta, pois delega características a outros elementos do AngularJS, melhorando a sua manutenção, testes, etc. Vale a pena visar aspectos um pouco mais avançados juntamente às diretivas, com outros Patterns unidos ao AngularJS. Assim podemos criar uma aplicação muito mais modular utilizando o melhor do javascript e do AngularJS.</p>

<p>Caso queiram ver este exemplo funcionando, acessem o plunker que criei com este exemplo.</p>

<p>Link Plunker: <a href="http://plnkr.co/edit/UHnbq5Nn5dNLsAPxOikk?p=preview">http://plnkr.co/edit/UHnbq5Nn5dNLsAPxOikk?p=preview</a></p>

<p>O que acharam? Como vocês utilizam no seu dia-a-dia?</p>

<p>Obrigado e até mais!</p>

<p>Links:</p>

<ul>
  <li>Documentação das diretivas: <a href="https://docs.angularjs.org/guide/directive">https://docs.angularjs.org/guide/directive</a></li>
  <li>Let’s Make Full-Ass AngularJS Directives: <a href="http://joelhooks.com/blog/2014/02/11/lets-make-full-ass-angularjs-directives/">http://joelhooks.com/blog/2014/02/11/lets-make-full-ass-angularjs-directives/</a></li>
  <li>Test Driven Development (TDD): <a href="http://pt.wikipedia.org/wiki/Test_Driven_Development">http://pt.wikipedia.org/wiki/Test_Driven_Development</a></li>
  <li>Red, Green, Refactor: <a href="http://www.jamesshore.com/Blog/Red-Green-Refactor.html">http://www.jamesshore.com/Blog/Red-Green-Refactor.html</a></li>
</ul>


          </div>
        </section>

        
          <section class="newsletter-content">
    <form action="http://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open('http://feedburner.google.com/fb/a/mailverify?uri=willmendesneto', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true;" >
        <h3 class="newsletter-title">Receba novidades por e-mail</h3>
        <p class="newsletter-text">Inscreva-se na minha newsletter para receber notificações de novos artigos no seu e-mail.</p>
        <input class="input-newsletter" type="email" name="email" placeholder="Digite o seu email"/>
        <input type="hidden" value="willmendesneto" name="uri"/>
        <input type="hidden" name="loc" value="en_US"/>
        <input class="btn btn-newsletter" type="submit" value="Assinar" />
    </form>
</section>

        

        <footer class="post-footer">

          <div class="addthis_toolbox addthis_default_style addthis_32x32_style">
  <a class="addthis_button_preferred_1"></a>
  <a class="addthis_button_preferred_2"></a>
  <a class="addthis_button_preferred_3"></a>
  <a class="addthis_button_preferred_4"></a>
  <a class="addthis_button_preferred_5"></a>
</div>


          <!-- <section class="share">
            
              
                <a class="icon-twitter" href="http://twitter.com/share?text=Trabalhando+com+Thin+Directives+no+AngularJS&amp;url=http://willmendesneto.github.io/2014/07/26/trabalhando-com-thin-directives-no-angularjs"
                  onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
                <i class="fa fa-twitter"></i><span class="hidden">twitter</span>
                </a>
              
            
              
                <a class="icon-facebook" href="//www.facebook.com/sharer.php?t=Trabalhando+com+Thin+Directives+no+AngularJS&amp;u=http://willmendesneto.github.io/2014/07/26/trabalhando-com-thin-directives-no-angularjs"
                  onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;">
                <i class="fa fa-facebook"></i><span class="hidden">facebook</span>
                </a>
              
            
              
            
              
                <a class="icon-google-plus" href="https://plus.google.com/share?t=Trabalhando+com+Thin+Directives+no+AngularJS&amp;url=http://willmendesneto.github.io/2014/07/26/trabalhando-com-thin-directives-no-angularjs"
                  onclick="window.open(this.href, 'google-plus-share', 'width=550,height=255');return false;">
                <i class="fa fa-google-plus"></i><span class="hidden">google-plus</span>
                </a>
              
            
          </section> -->
        </footer>
        <div class="bottom-teaser cf">
          <div class="isLeft">
            <section class="author">
              <div class="author-image" style="background-image: url(https://pt.gravatar.com/userimage/20307137/677413a79461cdfd62c8a65143214850.png?size=300)">Blog Logo</div>
              <h4>Wilson Mendes</h4>
              
                <p class="bio">Google Developer Expert (GDE) AngularJS e Google Developer Group (GDG) Salvador Organizer. Músico e desenhista nas horas vagas.</p>
              
              <hr>
              <p class="published">Publicado em <time datetime="2014-07-26 00:00">26 Jul 2014</time></p>
            </section>
            <footer class="site-footer">
              <section class="poweredby">Mais um blog feito com <a href="http://jekyllrb.com">Jekyll</a></section>
              <a class="subscribe" href="/feed.xml" target="_blank"> <span class="tooltip"> <i class="fa fa-rss"></i> Assine o feed.</span></a>
            </footer>
          </div>
          
        </div>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'willmendesnetogithubio'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */

        'use strict';

        function load() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

          // Remove o evento
          window.onscroll = function() {};
        }

        window.onscroll = function() {
          if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 2000)) {
            load();
          }
        };
        </script>

        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </article>

    </main>
    <div class="bottom-closer">
      <div class="background-closer-image"  style="background-image: url(/assets/images/background-1.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">Wilson Mendes - Blog</h1>
        <h2 class="blog-description">This is my blog, where i talk about technologies</h2>
        <a href="/" class="btn">Back to Home</a>
      </div>
    </div>

    
<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-53c591e4471ce379" async="async"></script>

<script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="https://hammerjs.github.io/dist/hammer.js"></script>
<script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/assets/js/index.js"></script>
<script type="text/javascript" src="/assets/js/readingTime.min.js"></script>
<script>

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-58169656-1', 'auto');
ga('send', 'pageview');

(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    $window.on('scroll', function() {
      var top = $window.scrollTop();

      if (top < 0 || top > 1500) { return; }
      $image
        .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
        .css('opacity', 1-Math.max(top/700, 0));
    });
    $window.trigger('scroll');

    var height = $('.article-image').height();
    $('.post-content').css('padding-top', height + 'px');

    $('a[href*=#]:not([href=#])').click(function() {
      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
       && location.hostname == this.hostname) {
        var target = $(this.hash);
        target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
        if (target.length) {
          $('html,body').animate({ scrollTop: target.offset().top }, 500);
          return false;
        }
      }
    });
  });
}(jQuery));
</script>

  </body>
</html>
